<div class = "container">
    <% if (tasks.length > 0) { %>
        <div class="row">
            <div class="col-lg-9">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Tasks</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <ul class="todo-list m-t">
                            <% _.each(tasks, function(task) { %>
                            <li>
                                <a href="#" class="check-link"><i class="fa fa-square-o"></i> </a>
                                <span class="m-l-xs"><%= task.description %><br>  Due: <%= task.endDate %></span>
                            </li>
                            <% }) %>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    <% } 
       else { 
       }
    %>

    <br>
    <h1><%= user.company.name %> - <%= user.username %>   
    <h3>Data last synced on: <%= user.integrations.nutshell.lastSyncedOn.date %> </h3>

    <div class="panel blank-panel">

        <div class="panel-heading">
            <div class="panel-title m-b-md"></div>
            <div class="panel-options">

                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true">Leads</a></li>
                    <li class=""><a data-toggle="tab" href="#tab-2" aria-expanded="false">Tickets</a></li>
                    <li class=""><a data-toggle="tab" href="#tab-3" aria-expanded="false">Communication</a></li>
                </ul>
            </div>
        </div>

        <div class="panel-body">

            <div class="tab-content">
                <div id="tab-1" class="tab-pane active">
                    <div class="col-lg-12">
                         <div class = "row">
                            <div class = "col-lg-4">
                                <div class = "tile blue">
                                <div class = "tile-content">    
                                    <div class = "number" style="font-size: 32px;"><%= '$'+ user.integrations.nutshell.performanceMetrics.sales.summaryData.won_lead_value.sum.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, "$&,")%></div>
                                    <h3> YTD Sales </h3>
                                </div>
                                </div>
                            </div>
                            <div class = "col-lg-4">
                                <div class = "tile green">
                                <div class = "tile-content">    
                                    <div class = "number" style="font-size: 32px;" id = 'projectedSales'><%= '$'+ (user.integrations.nutshell.performanceMetrics.sales.summaryData.won_lead_value.sum*15).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, "$&,")%></div>
                                    <h3> Projected Sales </h3>
                                </div>
                                </div>
                            </div>
                            <div class = "col-lg-4">
                                <div class="pie-charts green-pie">
                                    <div class="easy-pie-chart-green easyPieChart" id = 'percentGoal' data-percent="<%= (user.integrations.nutshell.performanceMetrics.sales.summaryData.won_lead_value.sum/user.company.salesGoal*100).toString()%>%" style="width: 100px; height: 100px; line-height: 100px;"> <canvas width="100" height="100"></canvas><%= (user.integrations.nutshell.performanceMetrics.sales.summaryData.won_lead_value.sum/user.company.salesGoal*100).toFixed(2).toString()%>%</div>
                                   <div class="label">Projected Goal</div>
                               </div>
                            </div>
                        </div>
                        <div class = "row">
                            <div class="form-group">
                                <label class="col-lg-3 col-md-3 col-sm-12 control-label">Monthly Sales Performance</label>
                                <div class="col-lg-9 col-md-9">
                                    <div class="row">
                                        <div class="col-lg-6 col-md-6">
                                            <select class="form-control" id = "monthOfInterest">              
                                             <option value="0">January</option>
                                             <option value="1">February</option>
                                             <option value="2">March</option>
                                             <option value="3">April</option>
                                             <option value="4">May</option>
                                             <option value="5">June</option>
                                             <option value="6">July</option>
                                             <option value="7">August</option>
                                             <option value="8">September</option>
                                             <option value="9">October</option>
                                             <option value="10">November</option>
                                             <option value="11">December</option> 
                                            </select>
                                        </br>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class= "row">
                            <div class= "col-lg-10 col-md-12">
                                <div class="panel panel-default toggle" id="spr_9">
                                    <!-- Start .panel -->
                                    <div class="panel-heading">
                                        <h4 class="panel-title"><i class="im-pie"></i> Monthly Metrics</h4>
                                        <div class="panel-controls panel-controls-hide" style="display: none;"><a href="#" class="toggle panel-minimize"><i class="im-minus"></i></a></div></div>
                                        <div class="panel-body">        
                                            <div class = "col-lg-7">
                                                
                                                <div class = "col-lg-6">
                                                    <!-- <div class = "tile blue"> -->
                                                        <div class="tile-stats b brall mb25" style="border: 1px solid #e7e7e2; border-radius: 4px;">
                                                            <a href="#">
                                                                <div class="tile-stats-icon"><i class="fa fa-money"></i>
                                                                </div>
                                                                <div class="tile-stats-content">
                                                                    <div id = "monthSales" class="tile-stats-number">$</div>
                                                                    <div class="tile-stats-text">Actual Sales</div>
                                                                </div>
                                                                <div class="clearfix"></div>
                                                            </a>
                                                        </div>
                            
                                                    <!--     <div class = "tile-content">    
                                                            <div id = "monthSales" class = "number"> 0 </div>
                                                            <h3> Sales </h3>
                                                        </div> -->
                                                    <!-- </div> -->
                                                </div>
                                                <div class = "col-lg-6">
                                                    <!-- <div class = "tile orange"> -->
                            
                                                    <div class="tile-stats b brall mb25 green-bg" style="border-radius: 4px;">
                                                            <a href="#">
                                                                <div class="tile-stats-icon"><i class="fa fa-money"></i>
                                                                </div>
                                                                <div class="tile-stats-content">
                                                                    <div id = "projMonthSales" class="tile-stats-number color-white"> </div>
                                                                    <div class="tile-stats-text color-white">Projected Sales</div>
                                                                </div>
                                                                <div class="clearfix"></div>
                                                            </a>
                                                        </div>
                                                        
                                                    <!-- <div class = "tile-stats b brall mb25 orange-bg">
                                                        <div class = "tile-stats-content">    
                                                            <div id = "pojMonthSales" class = "number">0</div>
                                                            <h3> Proj Sales </h3>
                                                        </div>
                                                    </div> -->
                                                 </div>     
                                                <div class = "col-lg-12 ">
                                                    <div class="tile dark" style="margin-top: 2%;">
                                                        <!-- tile start here -->
                                                        <div class="tile-icon">
                                                            <i class="ec-star s64"></i>
                                                        </div>
                                                        <div class="tile-content">
                                                            <div id = "monthSalesGoal" class="number countTo" data-from="0" data-to="2" style="font-size: 32px;">$100,000</div>
                                                            <h3>Sales Goal</h3>
                                                        </div>
                                                    </div>
                                                </div>                             
                                                
                                                <div class = "col-lg-12">
                                                    <div class="pie-charts green-pie">
                                                    <div id = "pctToGoal" class="easy-pie-chart-green easyPieChart" data-percent="0" style="width: 100px; height: 100px; line-  height: 100px; ">
                                                        <span class = "percent" id = "pctToGoalInner"> 0 </span>
                                                        <canvas width="100" height="100"></canvas>
                            
                                                    </div>
                                                    <div class="label">PCT To Goal </div>
                                                    </div>
                                                    <div class="pie-charts blue-pie">
                                                        <div id = "winRate"class="easy-pie-chart-blue easyPieChart" data-percent="0" style="width: 100px; height: 100px; line-  height: 100px;">
                                                            <span class = "percent" id = "winRateInner"> 0 </span>
                                                         <canvas width="100" height="100"></canvas>
                                                        </div>
                                                        <div class="label">Win Rate </div>
                                                    </div>
                                            
                                                    <div class="pie-charts">
                                                        <div id = "leadToClose" class="easy-pie-chart easyPieChart" data-percent="0" style="width: 100px; height: 100px; line-height: 100px;">
                                                            <span class = "percent" id = "leadToCloseInner"> 0 </span>
                                                            <canvas width="100" height="100"></canvas></div>
                                                        <div class="label">LeadsIn:LeadsOut</div>
                                                    </div>

                                                </div>

                                            </div> 
                                            
                                            <div class="col-lg-5 col-md-12">
                                                    <!-- Start col-lg-6 -->
                                                    <div class="panel panel-default toggle">
                                                        <!-- Start .panel -->
                                                        <div class="panel-heading">
                                                            <h4 id= "leadsTitle" class="panel-title"><i class="im-bars"></i> Need 10 Leads!</h4>
                                                        </div>
                                                        <div class="panel-body">
                                                            <div id="leads-bars-chart" style="width: 100%; height:250px;"></div>
                                                        </div>
                                                    </div>
                                                    <!-- End .panel -->
                                            </div>                       
                                        </div>
                                        <div class="panel panel-default plain toggle panelClose panelRefresh" id="spr_1">
                                     <!-- Start .panel -->
                                         <div class="panel-heading white-bg">
                                             <h4 class="panel-title"><%= redMetrics.Total_Red_Leads +' '%>Red Leads </h4>
                                             <div class="panel-controls panel-controls-hide" style="display: none;"><a href="#" class="panel-refresh"><i class="im-spinner6"></i></a><a href="#" class="toggle panel-minimize"><i class="im-minus"></i></a><a href="#" class="panel-close"><i class="im-close"></i></a></div></div>
                                             <div class="panel-body" style="display: block;">
                                             <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: 100%; height: auto;"><div class="table-responsive" style="overflow: hidden; width: 100%; height: auto;">
                                                <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th class="per20">Lead</th>
                                                        <th class="per40">Description</th>
                                                        <th class="per20">Value</th>
                                                        <th class="per20">Milestone</th>
                                                        <th>Link</th>
                                                       
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% for(var index in redLeads){for(i = 0; i<redLeads[index].length; i++) {  %>
                                                    <tr>
                                                        <td><%= redLeads[index][i].name%></td>
                                                        <td><%= redLeads[index][i].description%></td>
                                                        <td><%= redLeads[index][i].value%></td>
                                                        <td><%= redLeads[index][i].milestone%></td>
                                                        <td><a href="https://app02.nutshell.com/lead/<%= redLeads[index][i].name.slice(5,9) %>">Go to lead</a></td>
                                                    </tr>
                                                    <% }} %>
                                               </tbody>
                                            </table>
                                        </div> 
                                        <div class="slimScrollBar ui-draggable" style="height: 5px; position: absolute; bottom: 3px; opacity: 0.4; display: none; border-top-left-radius: 5px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; z-index: 99; width: 525px; left: 0px; background: rgb(153, 153, 153);">
                                        </div>
                                        <div class="slimScrollRail" style="width: 100%; height: 5px; position: absolute; bottom: 3px; display: none; border-top-left-radius: 5px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; opacity: 0.5; z-index: 90; background: rgb(51, 51, 51);">
                                        </div>
                                    </div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-2" class="tab-pane">
                    <div class="col-lg-10">
                        <div class="wrapper wrapper-content animated fadeInUp">
                            <table class="table">
                                <th>Subject</th>
                                <th>Requester</th>
                                <th>Request Date</th>
                                <th>Ticket Type</th>
                                <th>Status</th>
                                <th>Link</th>
                                <% _.each(organizationTickets, function(ticket) { %>
                                    <tr>
                                        <td><%= ticket.subject %></td>
                                        <td><%= ticket.requester_id %></td>
                                        <td><%= ticket.created_at %></td>
                                        <td><%= ticket.via.channel %></td>
                                        <td><%= ticket.status %></td>
                                        <td><a href="https://foundation53.zendesk.com/agent/tickets/<%= ticket.id %>">Go to ticket</a></td>
                                    </tr>
                                <% }) %>
                             </table>
                        </div>
                    </div>
                </div>

                <div id="tab-3" class="tab-pane">
                    <div class="col-lg-10">
                        <% if (communication != null) { %>
                            <%- partial ('../partials/smsHistory.ejs') %>
                        <% } else { %>
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>SMS History</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </div>
                            </div>

                            <div class="ibox-content inspinia-timeline" id="timelineWrapper">
                                
                                <div id="timeLine">

                                </div>
                            </div>

                        </div>

                            <h2 class="removeAfterSubmit">Looks like there's no number associated with this user... would you like to add one?</h2>
                            <input type= "text" class = "form-control removeAfterSubmit" placeholder="Add a number in the format 8045551234" maxlength="10" id="newNumber"><div class = "btn btn-lg btn-primary btn-block addNumber removeAfterSubmit" name="<%=user.id %>">Add</div>
                        <% } %>
                    </div>     
                </div>
            </div>

        </div>

    </div>

<script> 
var sales_data = <%- salesData %> ;
var lead_data = <%- leadData %> ;
var pipeline_data = <%- pipelineData %> ;
var goal = <%= user.salesGoal %>;
</script>